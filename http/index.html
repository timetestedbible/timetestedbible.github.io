<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Time Tested - Biblical Lunar Calendar</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Explore the biblical lunar calendar with Full Moon, Dark Moon, and Crescent Moon options. Track Sabbaths, feast days, priestly courses, and historical biblical events with precise astronomical calculations.">
  <meta name="keywords" content="lunar sabbath, biblical calendar, hebrew calendar, feast days, sabbath calendar, moon phases, priestly divisions, biblical timeline, Bible reader, appointed times, torah portions">
  <meta name="author" content="LunarSabbath.net">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://lunarsabbath.net/time-tested/">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lunarsabbath.net/time-tested/">
  <meta property="og:title" content="Time Tested - Biblical Lunar Calendar">
  <meta property="og:description" content="Explore the biblical lunar calendar with Full Moon, Dark Moon, and Crescent Moon options. Track Sabbaths, feast days, priestly courses, and historical biblical events.">
  <meta property="og:image" content="https://lunarsabbath.net/icons/icon-512.png">
  <meta property="og:site_name" content="LunarSabbath.net">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://lunarsabbath.net/time-tested/">
  <meta name="twitter:title" content="Time Tested - Biblical Lunar Calendar">
  <meta name="twitter:description" content="Explore the biblical lunar calendar with Full Moon, Dark Moon, and Crescent Moon options. Track Sabbaths, feast days, and historical biblical events.">
  <meta name="twitter:image" content="https://lunarsabbath.net/icons/icon-512.png">
  
  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Time Tested - Biblical Lunar Calendar",
    "description": "A biblical lunar calendar application for tracking Sabbaths, feast days, priestly courses, and historical events based on moon phases.",
    "url": "https://lunarsabbath.net/time-tested/",
    "applicationCategory": "LifestyleApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#1a3a5c">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Time Tested">
  
  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="/styles.css?v=122">
  <link rel="stylesheet" href="/components/world-map.css?v=1">
  <link rel="stylesheet" href="/components/dateline-map.css?v=5">
  <link rel="stylesheet" href="/assets/css/bible-styles.css?v=119">
</head>
<body>
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- TOP NAVIGATION -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <header id="top-nav" class="top-nav">
    <div class="top-nav-left">
      <!-- Logo / Brand -->
      <div class="brand" onclick="AppStore.dispatch({type:'SET_VIEW',view:'tutorial'})">
        <span class="brand-icon">üåï</span>
        <div class="brand-text">
          <div class="brand-title">Lunar Sabbath</div>
          <div class="brand-subtitle">a time tested tradition</div>
        </div>
      </div>
    </div>
    
    <div class="top-nav-center">
      <!-- PWA Navigation Buttons (hidden by default) -->
      <div id="pwa-nav-buttons" class="pwa-nav-buttons" style="display: none;">
        <button id="pwa-back-btn" class="pwa-nav-btn" title="Go back">‚óÄ</button>
        <button id="pwa-forward-btn" class="pwa-nav-btn" title="Go forward">‚ñ∂</button>
      </div>
    </div>
    
    <div class="top-nav-right">
      <!-- Navigation History Buttons -->
      <div class="nav-history-buttons">
        <button id="nav-back-btn" class="nav-btn" onclick="AppStore.dispatch({type:'NAV_BACK'})" title="Go back" disabled>‚óÄ</button>
        <button id="nav-forward-btn" class="nav-btn" onclick="AppStore.dispatch({type:'NAV_FORWARD'})" title="Go forward" disabled>‚ñ∂</button>
      </div>
      
      <!-- Today Button (calendar icon = changes calendar focus time) -->
      <button id="today-btn" class="today-btn" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},AppStore.getTodayEvent(),{type:'SET_VIEW',view:'calendar'}])">
        <span class="today-icon">üìÖ</span> Today
      </button>
      
      <!-- Hamburger Menu Button (mobile only, iOS style - right side) -->
      <button id="hamburger-btn" class="hamburger-btn" aria-label="Open menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
    </div>
  </header>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- MAIN LAYOUT -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="app-container" class="app-container">
    
    <!-- Menu Overlay (mobile) -->
    <div id="menu-overlay" class="menu-overlay"></div>
    
    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <!-- 3-COLUMN LAYOUT -->
    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="main-layout">
      <!-- Left Panel (Feasts & Priestly - inline on desktop, overlay on mobile) -->
      <aside id="left-panel" class="side-panel left-panel collapsed">
        <div class="panel-header">
          <span class="panel-title">üìÖ Year Overview</span>
          <button class="panel-close" data-panel="left">‚úï</button>
        </div>
        <div class="panel-content" id="left-panel-content">
          <!-- Feast list rendered by CalendarView -->
        </div>
      </aside>
      
      <!-- Center Content Area (expands to fill) -->
      <main id="content-area" class="content-area">
        <!-- Content rendered by ContentManager -->
        <div class="loading">Loading...</div>
      </main>
    </div>
    
    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <!-- SIDEBAR MENU (Desktop: fixed right, Mobile: slide-in) -->
    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <aside id="sidebar-menu" class="sidebar-menu">
      <div class="sidebar-header">
        <button class="sidebar-close-btn" onclick="AppStore.dispatch({type:'CLOSE_MENU'})">‚úï</button>
      </div>
      
      <nav class="sidebar-nav">
        <button class="menu-item" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},{type:'SET_VIEW',view:'reader',params:{contentType:'bible'}}])">
          <span class="menu-icon">üìñ</span>
          <span class="menu-label">Reader</span>
        </button>
        
        <button class="menu-item" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},{type:'SET_VIEW',view:'timeline'}])">
          <span class="menu-icon">‚è±Ô∏è</span>
          <span class="menu-label">Timeline</span>
        </button>
        
        <button class="menu-item" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},{type:'SET_VIEW',view:'reader',params:{contentType:'timetested'}}])">
          <span class="menu-icon">üìö</span>
          <span class="menu-label">Time-Tested</span>
        </button>
        
        <div class="menu-divider"></div>
        
        <button class="menu-item" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},{type:'SET_VIEW',view:'events'}])">
          <span class="menu-icon">üìú</span>
          <span class="menu-label">Events</span>
        </button>
        
        <button class="menu-item" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},{type:'SET_VIEW',view:'sabbath-tester'}])">
          <span class="menu-icon">üî¨</span>
          <span class="menu-label">Sabbath Tester</span>
        </button>
        
        <div class="menu-divider"></div>
        
        <button class="menu-item" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},{type:'SET_VIEW',view:'settings'}])">
          <span class="menu-icon">‚öôÔ∏è</span>
          <span class="menu-label">Settings</span>
        </button>
        
        <button class="menu-item" onclick="AppStore.dispatchBatch([{type:'CLOSE_MENU'},{type:'SET_VIEW',view:'tutorial'}])">
          <span class="menu-icon">‚ÑπÔ∏è</span>
          <span class="menu-label">About</span>
        </button>
        
        <div class="menu-divider"></div>
        
        <button class="menu-item" id="install-app-btn" style="display: none;" onclick="handleInstallClick()">
          <span class="menu-icon">üì≤</span>
          <span class="menu-label">Install App</span>
        </button>
        
        <div class="book-ad">
          <div class="book-ad-top">
            <div class="book-ad-title">TIME</div>
            <div class="book-ad-subtitle">Tested Tradition</div>
            <div class="book-ad-tagline">The Renewed Biblical Calendar</div>
          </div>
          <div class="book-ad-bottom">
            <div class="book-ad-author">By Daniel Larimer</div>
            <a class="book-ad-download" href="/media/time-tested-tradition.pdf" download>
              <span class="icon">üì•</span>
              <span>Download PDF</span>
            </a>
          </div>
        </div>
        
      </nav>
      
      </aside>
  </div>
  
  <!-- iOS Install Instructions Modal -->
  <div id="ios-install-overlay" class="ios-install-overlay" onclick="closeIOSInstallModal(event)">
    <div class="ios-install-modal" onclick="event.stopPropagation()">
      <button class="ios-install-close" onclick="closeIOSInstallModal()">‚úï</button>
      <div class="ios-install-header">
        <span class="ios-install-icon">üì≤</span>
        <h3>Install Time Tested</h3>
      </div>
      <p class="ios-install-intro">Add this app to your home screen for quick access and an app-like experience.</p>
      <div class="ios-install-steps">
        <div class="ios-install-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <p>Tap the <strong>Share</strong> button <span class="ios-share-icon">‚¨ÜÔ∏è</span> in Safari's toolbar</p>
          </div>
        </div>
        <div class="ios-install-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <p>Scroll down and tap <strong>"Add to Home Screen"</strong></p>
          </div>
        </div>
        <div class="ios-install-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <p>Tap <strong>"Add"</strong> in the top right corner</p>
          </div>
        </div>
      </div>
      <button class="ios-install-done-btn" onclick="closeIOSInstallModal()">Got it!</button>
    </div>
  </div>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- MODALS / OVERLAYS -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  
  <!-- Profile Picker Popup -->
  <div id="profile-picker" class="profile-picker" style="display: none;">
    <div class="profile-picker-header">
      <h3>Select Profile</h3>
      <button onclick="AppStore.dispatch({type:'SET_VIEW',view:'settings'}); AppStore.dispatch({type:'CLOSE_PROFILE_PICKER'});">‚öôÔ∏è</button>
    </div>
    <div id="profile-picker-list" class="profile-picker-list">
      <!-- Populated by JavaScript -->
    </div>
  </div>
  
  <!-- Strongs Panel (slide-in from right) -->
  <div id="strongs-panel" class="strongs-panel" style="display: none;">
    <div class="strongs-header">
      <button class="strongs-back" onclick="StrongsPanel.back()">‚óÄ</button>
      <h3 id="strongs-title">Strong's</h3>
      <button class="strongs-close" onclick="AppStore.dispatch({type:'CLOSE_STRONGS'})">‚úï</button>
    </div>
    <div id="strongs-content" class="strongs-content">
      <!-- Populated by JavaScript -->
    </div>
  </div>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- SCRIPTS -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  
  <!-- External Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
  
  <!-- Astronomy Engine Abstraction (loads Swiss Ephemeris, NASA Eclipse data) -->
  <script src="/astronomy-engine-abstraction.js?v=1"></script>
  <script src="/astronomy-utils.js?v=13"></script>
  <script src="/lunar-calendar-engine.js?v=3"></script>
  <script src="/jubilee-cycle.js?v=1"></script>
  <script src="/feasts.js?v=1"></script>
  <script src="/bible-events-loader.js?v=1"></script>
  <script src="/torah-portions.js?v=1"></script>
  <script src="/priestly-divisions.js?v=2"></script>
  
  <!-- Year utilities (BC/AD conversion) -->
  <script src="/year-utils.js?v=2"></script>
  
  <!-- Core (cache-bust with version) -->
  <script src="/app-store.js?v=32"></script>
  <script src="/url-router.js?v=17"></script>
  <script src="/layout.js?v=2"></script>
  <script src="/content-manager.js?v=2"></script>
  
  <!-- Components -->
  <script src="/components/world-map.js?v=1"></script>
  <script src="/components/dateline-map.js?v=21"></script>
  
  <!-- Views -->
  <script src="/views/calendar-view.js?v=82"></script>
  
  <!-- Bible Reader and Strong's Dictionaries -->
  <script src="/strongs-hebrew-dictionary.js"></script>
  <script src="/strongs-greek-dictionary.js"></script>
  <script src="/symbol-dictionary.js?v=1"></script>
  <script src="/book-scripture-index.js?v=1"></script>
  <script src="/cross-references.js?v=1"></script>
  <script src="/bible-reader.js?v=17"></script>
  <script src="/views/bible-view.js?v=12"></script>
  <script src="/views/symbols-view.js?v=1"></script>
  <script src="/views/reader-view.js?v=1"></script>
  
  <!-- Timeline and Historical Events -->
  <script src="/historical-events.js?v=2"></script>
  <script src="/event-resolver.js?v=1"></script>
  <script src="/biblical-timeline.js?v=2"></script>
  <script src="/views/timeline-view.js?v=5"></script>
  
  <!-- Day Detail and World Clock -->
  <script src="/day-detail.js?v=2"></script>
  <script src="/world-clock.js?v=1"></script>
  <script src="/views/book-view.js?v=2"></script>
  <script src="/views/tutorial-view.js?v=2"></script>
  <script src="/views/events-view.js?v=6"></script>
  <script src="/views/priestly-view.js?v=2"></script>
  <script src="/views/sabbath-tester-view.js?v=2"></script>
  <script src="/views/settings-view.js?v=2"></script>
  
  <!-- Initialize App -->
  <script>
    // FEASTS is now loaded from /feasts.js
    
    // Global state object - syncs with AppStore for compatibility with ported modules
    window.state = {
      lat: 31.7683,
      lon: 35.2137,
      year: new Date().getFullYear(),
      moonPhase: 'full',
      dayStartTime: 'morning',
      dayStartAngle: 12,
      yearStartRule: 'equinox',
      crescentThreshold: 18,
      sabbathMode: 'lunar',
      selectedProfile: 'timeTested',
      lunarMonths: [],
      currentMonthIndex: 0,
      highlightedLunarDay: 1
    };
    
    // Sync global state from AppStore (for ported modules)
    function syncGlobalState() {
      if (typeof AppStore === 'undefined') return;
      const s = AppStore.getState();
      const d = AppStore.getDerived();
      const profile = window.PROFILES?.[s.context.profileId] || {};
      
      window.state.lat = s.context.location.lat;
      window.state.lon = s.context.location.lon;
      window.state.year = d.year;
      window.state.moonPhase = profile.moonPhase || 'full';
      window.state.dayStartTime = profile.dayStartTime || 'morning';
      window.state.dayStartAngle = profile.dayStartAngle || 12;
      window.state.yearStartRule = profile.yearStartRule || 'equinox';
      window.state.crescentThreshold = profile.crescentThreshold || 18;
      window.state.sabbathMode = profile.sabbathMode || 'lunar';
      window.state.selectedProfile = s.context.profileId;
      window.state.lunarMonths = d.lunarMonths || [];
      window.state.currentMonthIndex = d.currentMonthIndex || 0;
      window.state.highlightedLunarDay = d.currentLunarDay || 1;
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('[App] Starting initialization...');
      
      // Profile definitions (needed for AppStore)
      const defaultProfiles = {
        timeTested: {
          name: 'Time-Tested',
          icon: 'üåï',
          moonPhase: 'full',
          dayStartTime: 'morning',
          dayStartAngle: 12,
          yearStartRule: 'equinox',
          crescentThreshold: 18,
          sabbathMode: 'lunar'
        },
        ancientTraditional: {
          name: 'Ancient Traditional',
          icon: 'üåí',
          moonPhase: 'crescent',
          dayStartTime: 'evening',
          dayStartAngle: 0,
          yearStartRule: '13daysBefore',
          crescentThreshold: 18,
          sabbathMode: 'saturday'
        },
        ministries119: {
          name: '119 Ministries',
          icon: 'üåë',
          moonPhase: 'dark',
          dayStartTime: 'evening',
          dayStartAngle: 0,
          yearStartRule: 'equinox',
          crescentThreshold: 18,
          sabbathMode: 'saturday'
        },
        creatorsCalendar: {
          name: "Creator's Calendar",
          icon: 'üåï',
          moonPhase: 'full',
          dayStartTime: 'morning',
          dayStartAngle: 0,
          yearStartRule: 'virgoFeet',
          crescentThreshold: 18,
          sabbathMode: 'lunar'
        },
        traditionalLunar: {
          name: 'Traditional Lunar',
          icon: 'üåí',
          moonPhase: 'crescent',
          dayStartTime: 'evening',
          dayStartAngle: 0,
          yearStartRule: 'equinox',
          crescentThreshold: 18,
          sabbathMode: 'lunar'
        }
      };
      
      window.PROFILES = defaultProfiles;
      
      // Initialize URL router first (synchronous, fast)
      URLRouter.init();
      
      // Start astronomy engine loading in background (don't block UI)
      const astroEnginePromise = (async () => {
        if (typeof initializeAstroEngine === 'function') {
          console.log('[App] Loading astronomy engine in background...');
          await initializeAstroEngine();
          console.log('[App] Astronomy engine ready:', getAstroEngine().name);
          return getAstroEngine();
        }
        return null;
      })();
      
      // Get the astronomy engine (may be null if still loading)
      const astroEngine = typeof getAstroEngine === 'function' ? getAstroEngine() : null;
      
      // Initialize AppStore with profiles (will use fallback if engine not ready)
      // Must be before Layout.init() since Layout subscribes to AppStore
      AppStore.init({
        profiles: defaultProfiles,
        astroEngine: astroEngine
      });
      
      // Initialize layout (subscribes to AppStore for menu state)
      Layout.init();
      
      // Initialize content manager (subscribes to AppStore for view changes)
      ContentManager.init();
      
      // Load supplementary data in parallel (don't block initial render)
      const dataPromises = [];
      if (typeof loadBibleEvents === 'function') {
        dataPromises.push(loadBibleEvents());
      }
      if (typeof loadTorahPortions === 'function') {
        dataPromises.push(loadTorahPortions());
      }
      if (typeof loadPriestlyDivisions === 'function') {
        dataPromises.push(loadPriestlyDivisions());
      }
      
      // Wait for all data to load, then refresh calendar with complete data
      Promise.all([astroEnginePromise, ...dataPromises]).then(() => {
        console.log('[App] All data loaded, refreshing calendar...');
        // Update AppStore with the now-ready astronomy engine
        const readyEngine = typeof getAstroEngine === 'function' ? getAstroEngine() : null;
        if (readyEngine) {
          AppStore.dispatch({ type: 'SET_ASTRO_ENGINE', payload: readyEngine });
        }
        AppStore.dispatch({ type: 'REFRESH' });
      });
      
      // Set up panel toggle handlers
      document.querySelectorAll('.panel-close').forEach(btn => {
        btn.addEventListener('click', () => {
          const panelId = btn.dataset.panel;
          const panel = document.getElementById(panelId + '-panel');
          if (panel) {
            panel.classList.add('collapsed');
            panel.classList.remove('open');
          }
        });
      });
      
      // Register views
      if (typeof CalendarView !== 'undefined') ContentManager.registerView('calendar', CalendarView);
      if (typeof BibleView !== 'undefined') ContentManager.registerView('bible', BibleView);
      if (typeof TimelineView !== 'undefined') ContentManager.registerView('timeline', TimelineView);
      if (typeof BookView !== 'undefined') ContentManager.registerView('book', BookView);
      if (typeof TutorialView !== 'undefined') ContentManager.registerView('tutorial', TutorialView);
      if (typeof EventsView !== 'undefined') ContentManager.registerView('events', EventsView);
      if (typeof PriestlyView !== 'undefined') ContentManager.registerView('priestly', PriestlyView);
      if (typeof SabbathTesterView !== 'undefined') ContentManager.registerView('sabbath-tester', SabbathTesterView);
      if (typeof SettingsView !== 'undefined') ContentManager.registerView('settings', SettingsView);
      
      // Load initial state from URL
      AppStore.dispatch({ type: 'INIT_FROM_URL', url: window.location });
      
      // Add initial URL to navigation history
      AppStore.dispatch({ type: 'NAV_PUSH', url: window.location.pathname + window.location.search });
      
      // Sync global state for ported modules
      syncGlobalState();
      AppStore.subscribe(syncGlobalState);
      
      // Update nav history button states
      function updateNavButtons() {
        const state = AppStore.getState();
        const backBtn = document.getElementById('nav-back-btn');
        const fwdBtn = document.getElementById('nav-forward-btn');
        if (backBtn) {
          backBtn.disabled = state.navHistory.index <= 0;
        }
        if (fwdBtn) {
          fwdBtn.disabled = state.navHistory.index >= state.navHistory.entries.length - 1;
        }
      }
      updateNavButtons();
      AppStore.subscribe(updateNavButtons);
      
      console.log('[App] Initialized successfully');
      
      // Register service worker for PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('[PWA] Service worker registered:', registration.scope);
          })
          .catch((error) => {
            console.warn('[PWA] Service worker registration failed:', error);
          });
      }
      
      // PWA Install handling
      setupInstallPrompt();
    });
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // PWA INSTALL FUNCTIONALITY
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    let deferredInstallPrompt = null;
    
    function setupInstallPrompt() {
      const installBtn = document.getElementById('install-app-btn');
      
      // Check if already installed as PWA
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true) {
        // Already installed, hide install button
        return;
      }
      
      // Listen for beforeinstallprompt (Chrome, Edge, etc.)
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredInstallPrompt = e;
        if (installBtn) installBtn.style.display = 'flex';
      });
      
      // On iOS, show the button with instructions
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
      if (isIOS && isSafari && installBtn) {
        installBtn.style.display = 'flex';
      }
    }
    
    function handleInstallClick() {
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      
      if (isIOS) {
        // Show iOS install instructions modal
        showIOSInstallModal();
      } else if (deferredInstallPrompt) {
        // Use the native install prompt
        deferredInstallPrompt.prompt();
        deferredInstallPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('[PWA] User accepted install prompt');
          }
          deferredInstallPrompt = null;
          const installBtn = document.getElementById('install-app-btn');
          if (installBtn) installBtn.style.display = 'none';
        });
      }
      
      // Close sidebar menu
      AppStore.dispatch({type: 'CLOSE_MENU'});
    }
    
    function showIOSInstallModal() {
      const overlay = document.getElementById('ios-install-overlay');
      if (overlay) {
        overlay.classList.add('visible');
      }
    }
    
    function closeIOSInstallModal(event) {
      if (event && event.target !== event.currentTarget) return;
      const overlay = document.getElementById('ios-install-overlay');
      if (overlay) {
        overlay.classList.remove('visible');
      }
    }
  </script>
</body>
</html>
